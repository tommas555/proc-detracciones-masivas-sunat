{% extends "_base.html" %} {% block title %}Mi Plan{% endblock %} {% block
content %}
<div class="container py-5">
  <div class="card shadow-sm" style="max-width: 800px; margin: 0 auto">
    <div class="card-header bg-primary text-white">
      <h4 class="mb-0">
        <i class="bi bi-check-circle-fill me-2"></i>
        Plan Activo: {{ subscription.plan.name }}
      </h4>
    </div>
    <div class="card-body">
      <div class="row mb-4">
        <div class="col-md-6">
          <h6 class="text-muted">Fecha de inicio</h6>
          <p class="fw-bold">
            {{ subscription.starts_at.strftime('%d/%m/%Y') }}
          </p>
        </div>
        <div class="col-md-6">
          <h6 class="text-muted">Vencimiento</h6>
          <p class="fw-bold">{{ subscription.ends_at.strftime('%d/%m/%Y') }}</p>
        </div>
      </div>

      <hr />

      <h5 class="mb-3">Servicios Incluidos</h5>
      {% for quota in subscription.plan.service_quotas %} {% set quota_info =
      current_user.get_current_quota(quota.service_id) %}
      <div class="mb-3 p-3 bg-light rounded">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="mb-0">{{ quota.service.name }}</h6>
          {% if quota_info.is_unlimited %}
          <span class="badge bg-success">Ilimitado</span>
          {% else %}
          <span class="badge bg-info"
            >{{ quota_info.used }} / {{ quota_info.quota }}</span
          >
          {% endif %}
        </div>

        {% if not quota_info.is_unlimited %}
        <div class="progress" style="height: 8px">
          <div
            class="progress-bar {% if quota_info.used / quota_info.quota < 0.7 %}bg-success{% elif quota_info.used / quota_info.quota < 0.9 %}bg-warning{% else %}bg-danger{% endif %}"
            role="progressbar"
            style="width: {{ (quota_info.used / quota_info.quota * 100)|round|int }}%"
            aria-valuenow="{{ quota_info.used }}"
            aria-valuemin="0"
            aria-valuemax="{{ quota_info.quota }}"
          ></div>
        </div>
        {% endif %}
      </div>
      {% endfor %}

      <hr />

      <div class="text-center">
        <a href="{{ url_for('home.index') }}" class="btn btn-primary">
          <i class="bi bi-house-door me-2"></i>Ir al Inicio
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
