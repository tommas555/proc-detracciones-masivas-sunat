{% extends "_base.html" %} {% block breadcrumb_inline %}
<span class="separator">›</span>
<span>Registro</span>
{% endblock %} {% block title %}Crear cuenta{% endblock %} {% block extra_css %}
<style>
  .register-container {
    max-width: 460px;
    margin: 3rem auto;
  }

  .form-floating > label {
    color: #6c757d;
  }

  .form-floating > .form-control:focus ~ label {
    color: #0d6efd;
  }

  .password-toggle {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #6c757d;
    cursor: pointer;
    padding: 0;
    z-index: 10;
  }

  .password-toggle:hover {
    color: #0d6efd;
  }

  .password-wrapper {
    position: relative;
  }

  .strength-meter {
    height: 4px;
    background: #e9ecef;
    border-radius: 2px;
    overflow: hidden;
    margin-top: 0.5rem;
  }

  .strength-meter-fill {
    height: 100%;
    width: 0%;
    transition: all 0.3s ease;
  }

  .strength-weak {
    background: #dc3545;
  }
  .strength-medium {
    background: #ffc107;
  }
  .strength-strong {
    background: #198754;
  }

  /* Estilos para el indicador de carga */
  .spinner-border-sm {
    width: 1rem;
    height: 1rem;
    border-width: 0.15em;
  }

  .btn-loading {
    position: relative;
    pointer-events: none;
    opacity: 0.8;
  }
</style>
{% endblock %} {% block content %}
<div class="register-container">
  <div class="card shadow-sm border-0">
    <div class="card-body p-4">
      <h3 class="mb-1">Crear cuenta</h3>
      <p class="text-muted small mb-4">Completa tus datos para comenzar</p>

      <form
        method="post"
        action="{{ url_for('auth.register_post') }}"
        id="registerForm"
      >
        <div class="form-floating mb-3">
          <input
            type="text"
            class="form-control"
            id="username"
            name="username"
            value="{{ request.form.get('username', '') }}"
            required
            minlength="3"
            maxlength="64"
            autocomplete="username"
          />
          <label for="username">Usuario</label>
        </div>

        <div class="form-floating mb-3">
          <input
            type="text"
            class="form-control"
            id="first_name"
            name="first_name"
            value="{{ request.form.get('first_name', '') }}"
            required
            maxlength="120"
            autocomplete="given-name"
          />
          <label for="first_name">Nombres</label>
        </div>

        <div class="form-floating mb-3">
          <input
            type="text"
            class="form-control"
            id="last_name"
            name="last_name"
            value="{{ request.form.get('last_name', '') }}"
            required
            maxlength="120"
            autocomplete="family-name"
          />
          <label for="last_name">Apellidos</label>
        </div>

        <div class="form-floating mb-3">
          <input
            type="tel"
            class="form-control"
            id="phone"
            name="phone"
            value="{{ request.form.get('phone', '') }}"
            maxlength="9"
            pattern="[0-9]{9}"
            placeholder="999888777"
            autocomplete="tel"
            oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 9)"
          />
          <label for="phone"
            >Celular <small class="text-muted">(opcional)</small></label
          >
          <div class="form-text small">9 dígitos sin espacios</div>
        </div>

        <div class="form-floating mb-3">
          <input
            type="email"
            class="form-control"
            id="email"
            name="email"
            value="{{ request.form.get('email', '') }}"
            required
            autocomplete="email"
          />
          <label for="email">Correo electrónico</label>
        </div>

        <div class="password-wrapper mb-2">
          <div class="form-floating">
            <input
              type="password"
              class="form-control"
              id="password"
              name="password"
              required
              minlength="6"
              autocomplete="new-password"
            />
            <label for="password">Contraseña</label>
          </div>
          <button type="button" class="password-toggle" id="togglePassword">
            <svg
              id="eyeIcon"
              width="20"
              height="20"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"
              />
              <path
                d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"
              />
            </svg>
          </button>
        </div>

        <div class="strength-meter mb-3">
          <div class="strength-meter-fill" id="strengthFill"></div>
        </div>
        <p class="small text-muted mb-4">Mínimo 6 caracteres</p>

        <button
          type="submit"
          class="btn btn-primary w-100 py-2 fw-semibold"
          id="submitBtn"
        >
          <span id="btnText">Crear mi cuenta</span>
          <span
            id="btnSpinner"
            class="spinner-border spinner-border-sm ms-2 d-none"
            role="status"
            aria-hidden="true"
          ></span>
        </button>

        <p class="text-center text-muted small mt-3 mb-0">
          ¿Ya tienes cuenta?
          <a
            href="{{ url_for('auth.login') }}"
            class="text-decoration-none fw-semibold"
            >Inicia sesión</a
          >
        </p>
      </form>
    </div>
  </div>
</div>

<script>
  const togglePassword = document.getElementById("togglePassword");
  const passwordInput = document.getElementById("password");
  const eyeIcon = document.getElementById("eyeIcon");
  const registerForm = document.getElementById("registerForm");
  const submitBtn = document.getElementById("submitBtn");
  const btnText = document.getElementById("btnText");
  const btnSpinner = document.getElementById("btnSpinner");

  togglePassword.addEventListener("click", () => {
    const type = passwordInput.type === "password" ? "text" : "password";
    passwordInput.type = type;

    if (type === "text") {
      eyeIcon.innerHTML =
        '<path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"/><path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z"/><path d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"/>';
    } else {
      eyeIcon.innerHTML =
        '<path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/><path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>';
    }
  });

  const strengthFill = document.getElementById("strengthFill");
  passwordInput.addEventListener("input", () => {
    const val = passwordInput.value;
    const len = val.length;

    strengthFill.className = "strength-meter-fill";

    if (len === 0) {
      strengthFill.style.width = "0%";
    } else if (len < 6) {
      strengthFill.classList.add("strength-weak");
      strengthFill.style.width = "33%";
    } else if (len < 10) {
      strengthFill.classList.add("strength-medium");
      strengthFill.style.width = "66%";
    } else {
      strengthFill.classList.add("strength-strong");
      strengthFill.style.width = "100%";
    }
  });

  // Prevenir envíos múltiples del formulario
  registerForm.addEventListener("submit", function (e) {
    // Deshabilitar el botón y mostrar indicador de carga
    submitBtn.disabled = true;
    submitBtn.classList.add("btn-loading");
    btnText.textContent = "Creando cuenta...";
    btnSpinner.classList.remove("d-none");

    // Evitar que el formulario se envíe múltiples veces
    // El formulario se enviará normalmente la primera vez
    registerForm.removeEventListener("submit", arguments.callee);
  });
</script>
{% endblock %}
